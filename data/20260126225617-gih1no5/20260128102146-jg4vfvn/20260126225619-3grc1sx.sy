{"ID":"20260126225619-3grc1sx","Spec":"2","Type":"NodeDocument","Properties":{"icon":"1f4bb","id":"20260126225619-3grc1sx","title":"第一章 网络IO，IO多路复用，网络编程接口","type":"doc","updated":"20260128111824"},"Children":[{"ID":"20260128103110-mwwijxp","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20260128103110-mwwijxp","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## "},{"Type":"NodeText","Data":"1. 客户端和服务端通信流程"}]},{"ID":"20260128103110-ylr9ght","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20260128103110-ylr9ght","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### "},{"Type":"NodeText","Data":"1.1 核心流程梳理"}]},{"ID":"20260128103110-8hedyvo","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20260128103110-8hedyvo","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### "},{"Type":"NodeText","Data":"客户端（Client）流程"}]},{"ID":"20260128103110-uxoqyxu","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MS4=","Num":1},"Properties":{"id":"20260128103110-uxoqyxu","updated":"20260128103110"},"Children":[{"ID":"20260128103110-7yjcgzn","Type":"NodeListItem","Data":"1.","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MS4=","Num":1},"Properties":{"id":"20260128103110-7yjcgzn","updated":"20260128103110"},"Children":[{"ID":"20260128103110-rcoj1nf","Type":"NodeParagraph","Properties":{"id":"20260128103110-rcoj1nf","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"创建 Socket 套接字；"}]}]},{"ID":"20260128103110-opdrhar","Type":"NodeListItem","Data":"2.","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mi4=","Num":2},"Properties":{"id":"20260128103110-opdrhar","updated":"20260128103110"},"Children":[{"ID":"20260128103110-iywavi2","Type":"NodeParagraph","Properties":{"id":"20260128103110-iywavi2","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"connect()"},{"Type":"NodeText","Data":" ​函数，传入目标服务端 IP 和端口；"}]}]},{"ID":"20260128103110-ldu978j","Type":"NodeListItem","Data":"3.","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"My4=","Num":3},"Properties":{"id":"20260128103110-ldu978j","updated":"20260128103110"},"Children":[{"ID":"20260128103110-kcsprl9","Type":"NodeParagraph","Properties":{"id":"20260128103110-kcsprl9","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"与服务端完成 TCP 三次握手后，基于该 Socket 循环收发数据；"}]}]},{"ID":"20260128103110-8rbe5lx","Type":"NodeListItem","Data":"4.","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NC4=","Num":4},"Properties":{"id":"20260128103110-8rbe5lx","updated":"20260128103110"},"Children":[{"ID":"20260128103110-39xaj6q","Type":"NodeParagraph","Properties":{"id":"20260128103110-39xaj6q","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"通信结束后调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"close()"},{"Type":"NodeText","Data":" ​关闭 Socket，触发 TCP 四次挥手。"}]}]}]},{"ID":"20260128103110-g99dsfi","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20260128103110-g99dsfi","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### "},{"Type":"NodeText","Data":"服务端（Server）流程"}]},{"ID":"20260128103110-6ww2iik","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MS4=","Num":1},"Properties":{"id":"20260128103110-6ww2iik","updated":"20260128103110"},"Children":[{"ID":"20260128103110-2npadeb","Type":"NodeListItem","Data":"1.","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MS4=","Num":1},"Properties":{"id":"20260128103110-2npadeb","updated":"20260128103110"},"Children":[{"ID":"20260128103110-apai3p5","Type":"NodeParagraph","Properties":{"id":"20260128103110-apai3p5","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"创建 Socket 套接字（记为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"listenfd"},{"Type":"NodeText","Data":"​，即监听 fd）；"}]}]},{"ID":"20260128103110-d9p0xhq","Type":"NodeListItem","Data":"2.","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mi4=","Num":2},"Properties":{"id":"20260128103110-d9p0xhq","updated":"20260128103110"},"Children":[{"ID":"20260128103110-irfbz2l","Type":"NodeParagraph","Properties":{"id":"20260128103110-irfbz2l","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"bind()"},{"Type":"NodeText","Data":" ​绑定服务端自身 IP 和端口；"}]}]},{"ID":"20260128103110-9gm2543","Type":"NodeListItem","Data":"3.","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"My4=","Num":3},"Properties":{"id":"20260128103110-9gm2543","updated":"20260128103110"},"Children":[{"ID":"20260128103110-m12smcj","Type":"NodeParagraph","Properties":{"id":"20260128103110-m12smcj","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"listen()"},{"Type":"NodeText","Data":" ​监听端口，此时内核创建半连接队列（三次握手未完成）和全连接队列（三次握手已完成）；"}]}]},{"ID":"20260128103110-c715l7x","Type":"NodeListItem","Data":"4.","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NC4=","Num":4},"Properties":{"id":"20260128103110-c715l7x","updated":"20260128103110"},"Children":[{"ID":"20260128103110-jpoxsdc","Type":"NodeParagraph","Properties":{"id":"20260128103110-jpoxsdc","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"客户端调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"connect()"},{"Type":"NodeText","Data":" ​后，内核完成 TCP 三次握手，连接进入全连接队列；"}]}]},{"ID":"20260128103110-258dyav","Type":"NodeListItem","Data":"5.","ListData":{"Typ":1,"Tight":true,"Start":5,"Delimiter":46,"Padding":3,"Marker":"NS4=","Num":5},"Properties":{"id":"20260128103110-258dyav","updated":"20260128103110"},"Children":[{"ID":"20260128103110-di3xsfg","Type":"NodeParagraph","Properties":{"id":"20260128103110-di3xsfg","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"服务端调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"accept(listenfd, \u0026amp;addr, \u0026amp;len)"},{"Type":"NodeText","Data":" ​从全连接队列取出连接，生成标识该客户端的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"clientfd"},{"Type":"NodeText","Data":"​（此时 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"accept"},{"Type":"NodeText","Data":" ​若无可用连接会阻塞）；"}]}]},{"ID":"20260128103110-pj8c520","Type":"NodeListItem","Data":"6.","ListData":{"Typ":1,"Tight":true,"Start":6,"Delimiter":46,"Padding":3,"Marker":"Ni4=","Num":6},"Properties":{"id":"20260128103110-pj8c520","updated":"20260128103110"},"Children":[{"ID":"20260128103110-8bj514a","Type":"NodeParagraph","Properties":{"id":"20260128103110-8bj514a","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"基于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"clientfd"},{"Type":"NodeText","Data":" ​循环读取（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"read/recv"},{"Type":"NodeText","Data":"​）客户端数据、处理数据、写入（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"write/send"},{"Type":"NodeText","Data":"​）响应数据；"}]}]},{"ID":"20260128103110-05bnlwa","Type":"NodeListItem","Data":"7.","ListData":{"Typ":1,"Tight":true,"Start":7,"Delimiter":46,"Padding":3,"Marker":"Ny4=","Num":7},"Properties":{"id":"20260128103110-05bnlwa","updated":"20260128103110"},"Children":[{"ID":"20260128103110-sq9vqy4","Type":"NodeParagraph","Properties":{"id":"20260128103110-sq9vqy4","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"检测到客户端关闭连接（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"read"},{"Type":"NodeText","Data":" ​返回 0，代表读取到 EOF，对应客户端第一次挥手的 FIN 包），关闭 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"clientfd"},{"Type":"NodeText","Data":" ​完成四次挥手。"}]}]}]},{"ID":"20260128103110-tvzgrxw","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20260128103110-tvzgrxw","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### "},{"Type":"NodeText","Data":"1.2 关键补充说明"}]},{"ID":"20260128103110-30gtz6c","Type":"NodeList","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-30gtz6c","updated":"20260128103110"},"Children":[{"ID":"20260128103110-55bthfy","Type":"NodeListItem","Data":"-","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-55bthfy","updated":"20260128103110"},"Children":[{"ID":"20260128103110-ksygx8v","Type":"NodeParagraph","Properties":{"id":"20260128103110-ksygx8v","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"clientfd"},{"Type":"NodeText","Data":" ​内核态对应两个缓冲区：接收缓冲区（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"recv_buf"},{"Type":"NodeText","Data":"​）、发送缓冲区（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"send_buf"},{"Type":"NodeText","Data":"​）；"}]}]},{"ID":"20260128103110-na4xrnp","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-na4xrnp","updated":"20260128103110"},"Children":[{"ID":"20260128103110-kir2bim","Type":"NodeParagraph","Properties":{"id":"20260128103110-kir2bim","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"数据读写核心接口："}]},{"ID":"20260128103110-fgzyo3b","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"Yw==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20260128103110-fgzyo3b","updated":"20260128103110"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"// 从clientfd读取数据到用户态buf，sz为预期读取字节数，n为实际读取字节数\nint n = read(clientfd, buf, sz);\n// 向clientfd写入buf中数据，sz为预期写入字节数，n为实际写入字节数\nint n = write(clientfd, buf, sz);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3}]},{"ID":"20260128103110-wlg81w3","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-wlg81w3","updated":"20260128103110"},"Children":[{"ID":"20260128103110-e5d9e5j","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-e5d9e5j","updated":"20260128103110"},"Children":[{"ID":"20260128103110-xq5mf2p","Type":"NodeParagraph","Properties":{"id":"20260128103110-xq5mf2p","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"buf"},{"Type":"NodeText","Data":" ​是用户态内存空间，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"read/write"},{"Type":"NodeText","Data":" ​本质是完成「内核态缓冲区 ↔ 用户态缓冲区」的数据拷贝；"}]}]},{"ID":"20260128103110-6zl2dh7","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-6zl2dh7","updated":"20260128103110"},"Children":[{"ID":"20260128103110-dh0wsie","Type":"NodeParagraph","Properties":{"id":"20260128103110-dh0wsie","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"read"},{"Type":"NodeText","Data":" ​返回 0：表示客户端关闭连接（内核在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"recv_buf"},{"Type":"NodeText","Data":" ​写入 EOF）；返回-1：表示读取出错（需结合 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"errno"},{"Type":"NodeText","Data":" ​判断具体原因）；"}]}]},{"ID":"20260128103110-ijm2u3v","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-ijm2u3v","updated":"20260128103110"},"Children":[{"ID":"20260128103110-7gli0ea","Type":"NodeParagraph","Properties":{"id":"20260128103110-7gli0ea","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"write"},{"Type":"NodeText","Data":" ​返回值小于 sz：可能是发送缓冲区已满，需循环写入剩余数据。"}]}]}]}]}]},{"ID":"20260128103110-vkz1tww","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20260128103110-vkz1tww","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## "},{"Type":"NodeText","Data":"2. 阻塞 IO 与非阻塞 IO"}]},{"ID":"20260128103110-62i4tz9","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20260128103110-62i4tz9","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### "},{"Type":"NodeText","Data":"2.1 核心概念"}]},{"ID":"20260128103110-684r56y","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-684r56y","updated":"20260128103110"},"Children":[{"ID":"20260128103110-j4f9zf8","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-j4f9zf8","updated":"20260128103110"},"Children":[{"ID":"20260128103110-rggrq36","Type":"NodeParagraph","Properties":{"id":"20260128103110-rggrq36","updated":"20260128103110"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"阻塞 IO"},{"Type":"NodeText","Data":"：当 IO 未就绪（如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"recv_buf"},{"Type":"NodeText","Data":" ​无数据、全连接队列无连接）时，调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"read/accept"},{"Type":"NodeText","Data":" ​等接口会阻塞当前线程，直到 IO 就绪；"}]}]},{"ID":"20260128103110-bwzz5k5","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-bwzz5k5","updated":"20260128103110"},"Children":[{"ID":"20260128103110-eiiw3xe","Type":"NodeParagraph","Properties":{"id":"20260128103110-eiiw3xe","updated":"20260128103110"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"非阻塞 IO"},{"Type":"NodeText","Data":"：当 IO 未就绪时，调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"read/accept"},{"Type":"NodeText","Data":" ​等接口不会阻塞线程，而是立即返回-1，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"errno"},{"Type":"NodeText","Data":" ​置为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EAGAIN"},{"Type":"NodeText","Data":"​/"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EWOULDBLOCK"},{"Type":"NodeText","Data":"​（表示需重试）。"}]}]}]},{"ID":"20260128103110-c16qsuk","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20260128103110-c16qsuk","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### "},{"Type":"NodeText","Data":"2.2 关键区别"}]},{"ID":"20260128103110-zghmscn","Type":"NodeTable","Data":"|场景|阻塞 IO|非阻塞 IO|\n| ---------------------| ----------------------| ----------------------|\n|IO 未就绪|阻塞线程等待|立即返回错误（非阻塞）|\n|IO 已就绪（数据拷贝）|执行内核 → 用户态拷贝|执行内核 → 用户态拷贝|","TableAligns":[0,0,0],"Properties":{"colgroup":"||","id":"20260128103110-zghmscn","updated":"20260128103110"},"Children":[{"Type":"NodeTableHead","Children":[{"Type":"NodeTableRow","Children":[{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"场景"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"阻塞 IO"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"非阻塞 IO"}]}]}]},{"Type":"NodeTableRow","TableAligns":[0,0,0],"Children":[{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"IO 未就绪"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"阻塞线程等待"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"立即返回错误（非阻塞）"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0,0],"Children":[{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"IO 已就绪（数据拷贝）"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"执行内核 → 用户态拷贝"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"执行内核 → 用户态拷贝"}]}]}]},{"ID":"20260128103110-qk21pkb","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20260128103110-qk21pkb","updated":"20260128111824"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### "},{"Type":"NodeText","Data":"2.3 模式设置方式"}]},{"ID":"20260128103110-ozc81sr","Type":"NodeParagraph","Properties":{"id":"20260128103110-ozc81sr","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"Socket 默认为阻塞模式，可通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"fcntl"},{"Type":"NodeText","Data":" ​接口设置为非阻塞："}]},{"ID":"20260128103110-8onrxvm","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20260128103110-8onrxvm","updated":"20260128111824"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"int flag = fcntl(new_fd, F_GETFL, 0); // 先获取原有属性\nfcntl(new_fd, F_SETFL, flag | O_NONBLOCK); // 添加非阻塞属性\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20260128103110-6su40dl","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20260128103110-6su40dl","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## "},{"Type":"NodeText","Data":"3. IO 多路复用"}]},{"ID":"20260128103110-j6tjkm7","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20260128103110-j6tjkm7","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### "},{"Type":"NodeText","Data":"3.1 核心解决问题"}]},{"ID":"20260128103110-8ma5246","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-8ma5246","updated":"20260128103110"},"Children":[{"ID":"20260128103110-di423lh","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-di423lh","updated":"20260128103110"},"Children":[{"ID":"20260128103110-b5w872k","Type":"NodeParagraph","Properties":{"id":"20260128103110-b5w872k","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"阻塞 IO 需「一个线程对应一个客户端连接」，高并发下线程资源耗尽；"}]}]},{"ID":"20260128103110-cvcczlf","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-cvcczlf","updated":"20260128103110"},"Children":[{"ID":"20260128103110-ndvxkk6","Type":"NodeParagraph","Properties":{"id":"20260128103110-ndvxkk6","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"非阻塞 IO 需轮询检测每个 Socket 是否就绪，CPU 空耗严重；"}]}]},{"ID":"20260128103110-z8lbmjw","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-z8lbmjw","updated":"20260128103110"},"Children":[{"ID":"20260128103110-yqys8me","Type":"NodeParagraph","Properties":{"id":"20260128103110-yqys8me","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"IO 多路复用："},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"单个线程同时检测多路 Socket 是否就绪"},{"Type":"NodeText","Data":"，就绪后再调用 IO 接口（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"read/write/accept"},{"Type":"NodeText","Data":"​），兼顾性能与资源利用率。"}]}]}]},{"ID":"20260128103110-ghgx48k","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20260128103110-ghgx48k","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### "},{"Type":"NodeText","Data":"3.2 核心特性"}]},{"ID":"20260128103110-dqfxt26","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-dqfxt26","updated":"20260128103110"},"Children":[{"ID":"20260128103110-1tl074i","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-1tl074i","updated":"20260128103110"},"Children":[{"ID":"20260128103110-gdbfkje","Type":"NodeParagraph","Properties":{"id":"20260128103110-gdbfkje","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"仅负责「检测 Socket 就绪状态」（如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"recv_buf"},{"Type":"NodeText","Data":" ​是否有数据、全连接队列是否有新连接），不直接执行 IO 操作；"}]}]},{"ID":"20260128103110-wcpe2fm","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-wcpe2fm","updated":"20260128103110"},"Children":[{"ID":"20260128103110-r7qn1fd","Type":"NodeParagraph","Properties":{"id":"20260128103110-r7qn1fd","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"普通网络 IO 接口（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"read/accept"},{"Type":"NodeText","Data":"​）仅能检测单个 Socket 就绪状态，多路复用可批量检测。"}]}]}]},{"ID":"20260128103110-u6uue9c","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20260128103110-u6uue9c","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### "},{"Type":"NodeText","Data":"3.3 三种核心接口对比"}]},{"ID":"20260128103110-tiollzl","Type":"NodeTable","Data":"|接口|底层实现|连接数限制|触发模式|\n| ------| -----------------| ----------| ------------------------------|\n|select|位图/数组|最大 1024|仅水平触发（LT）|\n|poll|链表|无限制|仅水平触发（LT）|\n|epoll|红黑树 + 就绪链表|无限制|水平触发（LT）、边缘触发（ET）|","TableAligns":[0,0,0,0],"Properties":{"colgroup":"|||","id":"20260128103110-tiollzl","updated":"20260128103110"},"Children":[{"Type":"NodeTableHead","Children":[{"Type":"NodeTableRow","Children":[{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"接口"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"底层实现"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"连接数限制"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"触发模式"}]}]}]},{"Type":"NodeTableRow","TableAligns":[0,0,0,0],"Children":[{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"select"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"位图/数组"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"最大 1024"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"仅水平触发（LT）"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0,0,0],"Children":[{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"poll"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"链表"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"无限制"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"仅水平触发（LT）"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0,0,0],"Children":[{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"epoll"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"红黑树 + 就绪链表"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"无限制"}]},{"Type":"NodeTableCell","Children":[{"Type":"NodeText","Data":"水平触发（LT）、边缘触发（ET）"}]}]}]},{"ID":"20260128103110-moyijyk","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20260128103110-moyijyk","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### "},{"Type":"NodeText","Data":"3.4 触发模式（LT/ET）"}]},{"ID":"20260128103110-n697c41","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20260128103110-n697c41","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### "},{"Type":"NodeText","Data":"基本定义"}]},{"ID":"20260128103110-z8weviu","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-z8weviu","updated":"20260128103110"},"Children":[{"ID":"20260128103110-gkdivm4","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-gkdivm4","updated":"20260128103110"},"Children":[{"ID":"20260128103110-qoq6u6c","Type":"NodeParagraph","Properties":{"id":"20260128103110-qoq6u6c","updated":"20260128103110"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"水平触发（LT）"},{"Type":"NodeText","Data":"：只要 Socket 处于就绪状态（如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"recv_buf"},{"Type":"NodeText","Data":" ​有数据），每次调用多路复用接口都会返回该 Socket，直到数据被读完；"}]}]},{"ID":"20260128103110-vgz4e0y","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20260128103110-vgz4e0y","updated":"20260128103110"},"Children":[{"ID":"20260128103110-24l1qka","Type":"NodeParagraph","Properties":{"id":"20260128103110-24l1qka","updated":"20260128103110"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"边缘触发（ET）"},{"Type":"NodeText","Data":"：仅当 Socket 就绪状态「从无到有」时（如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"recv_buf"},{"Type":"NodeText","Data":" ​从空变为有数据），才返回该 Socket，需一次性读完所有数据（否则后续不会再通知）。"}]}]}]},{"ID":"20260128103110-ua6izfh","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20260128103110-ua6izfh","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### "},{"Type":"NodeText","Data":"接口补充"}]},{"ID":"20260128103110-n1avsdw","Type":"NodeParagraph","Properties":{"id":"20260128103110-n1avsdw","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"epoll 核心等待接口："}]},{"ID":"20260128103110-3cuw3w9","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"Yw==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20260128103110-3cuw3w9","updated":"20260128103110"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"// epfd：epoll实例句柄；evs：输出就绪事件数组；evs_len：数组长度；timeout：超时时间（ms，-1为永久阻塞）\n// 返回值：就绪的Socket数量\nint n = epoll_wait(epfd, evs, evs_len, timeout);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3}]},{"ID":"20260128103110-jxl54cs","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20260128103110-jxl54cs","updated":"20260128103110"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### "},{"Type":"NodeText","Data":"3.5 核心价值"}]},{"ID":"20260128103110-nintghg","Type":"NodeParagraph","Properties":{"id":"20260128103110-nintghg","updated":"20260128103110"},"Children":[{"Type":"NodeText","Data":"解决非阻塞 IO「何时调用 read/recv」的问题：通过多路复用检测到 Socket 就绪后，再调用 IO 接口，避免盲轮询，提升 CPU 利用率。"}]}]}